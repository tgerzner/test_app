<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="user-scalable=no,initial-scale=1, maximum-scale=1,minimum-scale=1, width=device-width" />
        <title>PhoneGap Application</title>
        <link rel="stylesheet" href="css/jquery.mobile-1.3.2.css" />
        <script src="js/jquery-1.10.2.min.js"></script>
        <script src="js/jquery.mobile-1.3.2.min.js"></script>
        <script src="js/main.js"></script>
        <script src="cordova.js"></script>
        <script type="text/javascript">
            // Wait for PhoneGap to load
            document.addEventListener("deviceready", onDeviceReady, false);

            $( document ).ready(function() {
                $('button#get_photo').bind('click', function(e) {
                    console.log('Get Photo');
                });
            });

            // PhoneGap is ready
            function onDeviceReady() {
            }

                //If Success
            function captureSuccess(mediaFiles) {
                alert("captureSuccess");
                //var i, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    alert(mediaFiles[i].fullPath);
                    uploadFile(mediaFiles[i]);
                }

            }

            //If Error
            function captureError(error) {
                //var errMsg = 'An error occurred during capture: ' + error.code;
                //navigator.notification.alert(errMsg, null, 'Uh oh!');
                alert('error');
            }

            //Call With Button
            function takePhoto() {
                alert("aaa");
                navigator.device.capture.captureImage(captureSuccess, captureError);
                alert("captureSuccess");
            }

            //Upload To Server
            function uploadFile(mediaFile) {
                alert("ccc");
                var ft = new FileTransfer(),
                    path = mediaFile.fullPath,
                    name = mediaFile.name;
                alert("uploadFile");

                ft.upload(path,
                    "http://see--you.ch/photos/upload.php",
                    function(result) {
                        console.log('Upload success: ' + result.responseCode);
                        console.log(result.bytesSent + ' bytes sent');
                    },
                    function(error) {
                        console.log('Error uploading image ' + path + ': ' + error.code);
                    },
                    { fileName: name });
            }


            //Get Location
            function get_geolocation(){
                console.log('Get Geolocation');
                navigator.geolocation.getCurrentPosition(geoloc_onSuccess, geoloc_onError);
                return
            }

            // Get lat, lon, time
            function geoloc_onSuccess(position) {
                var lat = position.coords.latitude
                var lon = position.coords.longitude
                var time = position.coords.timestamp
                console.log(time);
                console.log(lat);
                console.log(lon);
            }

            // If an error occurs
            function geoloc_onError(error) {
                var errString = '';
                if (error.code) {
                    switch (error.code) {
                        case 1:
                            errString =
                                    'We do not have permission';
                            break;
                        case 2:
                            errString =
                                    'The location can not be determined';
                            break;
                        case 3:
                            errString =
                                    'There was a timeout';
                            break;
                        default:
                            errString =
                                    'Unknown error';
                            break
                    }
                }
            }



        </script>
    </head>
    <body>
        <div data-role="page">
            <div data-role="header">
                <h1>See You</h1>
            </div><!-- /header -->

            <div data-role="content">

               <button onclick="takePhoto()">Take Photo</button>
               <br />
                <button onclick="getPhoto()">Get Photo</button>
               <br />
                <img style="display: none;width: 200px;height: 190px;" id="dataImage" src="" />
                <br />
                <img style="display: none;width: 200px;height: 190px;" id="urlImage" src="" />
                <br />
                 <button onclick="get_geolocation();">Get Geolocation</button>
                <br />

                <div id="message"></div>
                <br />
            </div><!-- /content -->
            <div id="footer" data-role="footer">
                <h4><span>Copyright &copy; 2014</span></h4>
            </div><!-- /footer -->
        </div><!-- /page -->
    </body>
</html>
